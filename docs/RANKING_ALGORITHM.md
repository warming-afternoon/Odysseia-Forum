# UCB1 搜索排序算法 (综合排序算法) 说明

## 核心思想

评估一个帖子时，会考虑两个方面：

1.  它已经获得的反应数 (实力)
2.  它身上隐藏的潜力 (机会)

通过这种方式，算法能够动态地给予新内容曝光机会，并根据真实的用户反馈（是否添加反应）来决定它应该继续留在顶端，还是沉下去。

## 工作原理

**公式：**

`Score = W * (x / n) + C * sqrt(ln(N) / n)`

-   `x` = 帖子的当前反应数。
-   `n` = 这个帖子被展示在搜索结果中的次数。
-   `N` = 全局的，所有帖子通过 bot 搜索进行展示的次数总和。
-   `W` = 放大系数，用于放大帖子实力分。
-   `C` = 探索因子，一个可以调整的常数，用于控制给“潜力”多大的权重。
-   `sqrt(...)` : 使用平方根，平滑“机会分”的下降速度。

### 算法如何工作：

1.  **实力部分 (Exploitation):** `W * (x / n)`
    -   这代表了帖子的平均反应数（每次展示平均能获得多少反应）。这是它的“实力分”。
    -   一个帖子的实力越被证明，这部分得分越高。

2.  **潜力部分 (Exploration):** `C * sqrt(ln(N) / n)`
    -   这是它的“机会分”或“不确定性加分”。
    -   当一个帖子是**新帖**时，`n` 很小，`ln(N) / n` 这个值就很大，所以它的“机会分”很高，会因此获得很高的排名，得到曝光机会。
    -   随着它被展示的次数 `n` 越来越多，它的“机会分”会慢慢下降。
    -   此时，如果它确实是好作品，它的 `x` (反应数) 会增加，靠“实力分”维持排名；如果它不是好作品，`x` 不增加，那么总分下降，它就会沉下去。

## 优点

-   **动态平衡**：能在新帖曝光和热帖留存之间动态调整。被反复展示的热门帖子将由于 `n` 的增加而导致“机会分”下降，为新帖子腾出空间。
-   **发掘潜力**：周期性地把一些被展示次数少的旧帖子也提上来“再试试”，从而重新给予旧帖子重曝光的机会。
-   **数据驱动**：完全基于用户的实际互动（展示、反应）来决定帖子的排序，更加客观。

## 缺点

-   **冷启动问题**：在系统初期，`N` 很小，可能会导致分数波动较大。
-   **参数敏感**：探索因子 `C` 和权重 `W` 的设置对算法效果有较大影响，需要根据社区反馈进行调整。

## 配置参数

### UCB1 算法配置
-   `UCB1_EXPLORATION_FACTOR` (C): 探索因子，控制对新内容和不确定内容的探索力度。 (默认: 2.0)
-   `UCB1_STRENGTH_WEIGHT` (W): 实力权重，放大帖子自身实力（平均反应数）在总分中的占比。 (默认: 1.0)

## 使用方法

### 管理员配置
```
/配置 全局设置 
```

### 搜索结果显示

每个搜索结果会考虑其实力分和机会分，但为了界面简洁，不会直接展示这两个分数，而是合并为最终的排序结果。